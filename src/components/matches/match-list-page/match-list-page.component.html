<!-- MatchListPage - Lista meczów -->
<!-- Używa AppLayoutComponent jako bazowego layoutu -->

<app-layout
  [userName]="userName()"
  [userInitials]="userInitials()"
  [activeMenuIndex]="0"
>
  <!-- Nagłówek strony -->
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-surface-900">Moje mecze</h1>
    <p-button
      label="Nowy mecz"
      icon="pi pi-plus"
      severity="primary"
      (onClick)="onNewMatchClick()"
    />
  </div>

  <!-- Sekcja filtrów -->
  <div class="flex flex-col sm:flex-row gap-4 mb-6">
    <!-- Filtr zawodnika -->
    <p-iconfield iconPosition="left" class="flex-1">
      <p-inputicon styleClass="pi pi-user" />
      <input
        type="text"
        pInputText
        placeholder="Wyszukaj mecze zawodnika"
        #playerInput
        [value]="filters().playerName"
        (input)="onPlayerNameFilterChange(playerInput.value)"
        class="w-full"
      />
    </p-iconfield>

    <!-- Filtr rywala -->
    <p-iconfield iconPosition="left" class="flex-1">
      <p-inputicon styleClass="pi pi-users" />
      <input
        type="text"
        pInputText
        placeholder="Wyszukaj mecze rywala"
        #opponentInput
        [value]="filters().opponentName"
        (input)="onOpponentNameFilterChange(opponentInput.value)"
        class="w-full"
      />
    </p-iconfield>

    <!-- Przycisk czyszczenia filtrów -->
    @if (hasActiveFilters()) {
      <p-button
        label="Wyczyść"
        icon="pi pi-filter-slash"
        [outlined]="true"
        (onClick)="onClearFilters()"
      />
    }
  </div>

  <!-- Skeleton loading -->
  @if (isLoading()) {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      @for (item of [1, 2, 3, 4, 5, 6]; track item) {
        <div class="bg-surface-0 border border-surface-200 rounded-xl p-4">
          <p-skeleton width="4rem" height="1.5rem" styleClass="mb-3" />
          <p-skeleton width="100%" height="1.5rem" styleClass="mb-2" />
          <p-skeleton width="3rem" height="2rem" styleClass="mb-2" />
          <p-skeleton width="8rem" height="1rem" />
        </div>
      }
    </div>
  }

  <!-- Empty State -->
  @else if (isEmpty()) {
    <div class="flex flex-col items-center justify-center py-16">
      <i class="pi pi-inbox text-6xl text-surface-400 mb-4"></i>
      <h2 class="text-xl font-semibold text-surface-700 mb-2">
        Nie masz jeszcze żadnych meczów
      </h2>
      <p class="text-surface-500 mb-6 text-center">
        Utwórz swój pierwszy mecz, aby rozpocząć rejestrowanie
      </p>
      <p-button
        label="Utwórz pierwszy mecz"
        icon="pi pi-plus"
        severity="primary"
        (onClick)="onNewMatchClick()"
      />
    </div>
  }

  <!-- Grid kart meczów -->
  @else {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      @for (match of matches(); track match.id) {
        <article
          class="match-card bg-surface-0 border border-surface-200 rounded-xl p-4 cursor-pointer transition-all duration-200 hover:shadow-lg hover:border-primary-500"
          pRipple
          (click)="onMatchClick(match)"
        >
          <!-- Badge statusu -->
          <div class="flex items-center justify-between mb-3">
            <p-tag
              [value]="getMatchStatusLabel(match.status)"
              [severity]="getMatchStatusSeverity(match.status)"
            />
            <p-button
              icon="pi pi-trash"
              [text]="true"
              severity="danger"
              size="small"
              (onClick)="onDeleteClick($event, match)"
              [attr.aria-label]="'Usuń mecz ' + match.player_name + ' vs ' + match.opponent_name"
            />
          </div>

          <!-- Nazwy zawodników -->
          <div class="mb-3">
            <div class="text-lg font-semibold text-surface-900 mb-1">
              {{ match.player_name }}
              <span class="text-surface-500 font-normal">vs</span>
              {{ match.opponent_name }}
            </div>
          </div>

          <!-- Wynik setowy -->
          <div class="text-2xl font-bold text-primary-500 mb-2">
            {{ match.sets_won_player }} : {{ match.sets_won_opponent }}
          </div>

          <!-- Data rozpoczęcia -->
          <div class="text-sm text-surface-500">
            {{ match.started_at | date: 'dd.MM.yyyy, HH:mm' }}
          </div>
        </article>
      }
    </div>
  }

  <!-- Paginator (widoczny gdy są wyniki) -->
  @if (!isEmpty() && !isLoading()) {
    <div class="mt-6">
      <p-paginator
        [first]="paginatorFirst()"
        [rows]="pagination().limit"
        [totalRecords]="pagination().total"
        [rowsPerPageOptions]="rowsPerPageOptions"
        (onPageChange)="onPageChange($event)"
      />
    </div>
  }
</app-layout>
