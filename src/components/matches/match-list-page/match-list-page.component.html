<!-- MatchListPage - Lista meczów -->
<!-- Używa AppLayoutComponent jako bazowego layoutu -->

<app-layout
  [userName]="userName()"
  [userInitials]="userInitials()"
  [userAvatarUrl]="userAvatarUrl()"
  [activeMenuIndex]="0"
>
  <!-- Nagłówek strony -->
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-surface-900">Moje mecze</h1>
    <p-button
      label="Nowy mecz"
      icon="pi pi-plus"
      severity="primary"
      (onClick)="onNewMatchClick()"
    />
  </div>

  <!-- Sekcja filtrów -->
  <div class="bg-surface-0 border border-surface-200 rounded-xl p-4 mb-6 shadow-sm">
    <div class="flex flex-col sm:flex-row gap-4">
      <!-- Filtr zawodnika -->
      <p-iconfield iconPosition="left" class="flex-1">
        <p-inputicon styleClass="pi pi-user" />
        <input
          type="text"
          pInputText
          placeholder="Wyszukaj mecze zawodnika"
          #playerInput
          [value]="filters().playerName"
          (input)="onPlayerNameFilterChange(playerInput.value)"
          class="w-full"
        />
      </p-iconfield>

      <!-- Filtr rywala -->
      <p-iconfield iconPosition="left" class="flex-1">
        <p-inputicon styleClass="pi pi-users" />
        <input
          type="text"
          pInputText
          placeholder="Wyszukaj mecze rywala"
          #opponentInput
          [value]="filters().opponentName"
          (input)="onOpponentNameFilterChange(opponentInput.value)"
          class="w-full"
        />
      </p-iconfield>

      <!-- Przycisk czyszczenia filtrów -->
      <div class="sm:flex-shrink-0 flex justify-end">
        <p-button
          label="Wyczyść"
          icon="pi pi-filter-slash"
          severity="success"
          [outlined]="true"
          [disabled]="!hasActiveFilters()"
          (onClick)="onClearFilters()"
        />
      </div>
    </div>
  </div>

  <!-- Skeleton loading -->
  @if (isLoading()) {
    <div class="flex flex-col gap-3">
      @for (item of [1, 2, 3, 4, 5, 6]; track item) {
        <div class="bg-surface-0 border border-surface-200 rounded-xl p-4">
          <div class="flex items-center justify-between gap-4">
            <p-skeleton width="4rem" height="1.5rem" />
            <p-skeleton width="30%" height="1.5rem" />
            <p-skeleton width="8rem" height="2rem" />
            <p-skeleton width="10rem" height="1rem" />
            <p-skeleton width="2rem" height="2rem" styleClass="rounded-full" />
          </div>
        </div>
      }
    </div>
  }

  <!-- Empty State -->
  @else if (isEmpty()) {
    <div class="flex flex-col items-center justify-center py-16">
      <i class="pi pi-inbox text-6xl text-surface-400 mb-4"></i>
      <h2 class="text-xl font-semibold text-surface-700 mb-2">
        Nie masz jeszcze żadnych meczów
      </h2>
      <p class="text-surface-500 mb-6 text-center">
        Utwórz swój pierwszy mecz, aby rozpocząć rejestrowanie
      </p>
      <p-button
        label="Utwórz pierwszy mecz"
        icon="pi pi-plus"
        severity="primary"
        (onClick)="onNewMatchClick()"
      />
    </div>
  }

  <!-- Lista wierszy meczów -->
  @else {
    <div class="flex flex-col gap-3">
      @for (match of matches(); track match.id) {
        <article
          class="match-row bg-surface-0 border border-surface-200 rounded-xl p-4 cursor-pointer transition-all duration-200 hover:shadow-lg hover:border-primary-500"
          pRipple
          (click)="onMatchClick(match)"
        >
          <div class="flex flex-wrap items-center justify-between gap-4">
            <!-- Badge statusu -->
            <div class="flex-shrink-0">
              <p-tag
                [value]="getMatchStatusLabel(match.status)"
                [severity]="getMatchStatusSeverity(match.status)"
              />
            </div>

            <!-- Nazwy zawodników -->
            <div class="flex-1 min-w-[200px]">
              <div class="text-base sm:text-lg font-semibold text-surface-900">
                {{ match.player_name }}
                <span class="text-surface-500 font-normal mx-1">vs</span>
                {{ match.opponent_name }}
              </div>
            </div>

            <!-- Wynik setowy -->
            <div class="flex-shrink-0 text-xl sm:text-2xl font-bold text-surface-600 dark:text-white">
              {{ match.sets_won_player }} : {{ match.sets_won_opponent }}
            </div>

            <!-- Data rozpoczęcia -->
            <div class="flex-shrink-0 text-sm text-surface-500 min-w-[140px] text-right">
              {{ match.started_at | date: 'dd.MM.yyyy, HH:mm' }}
            </div>

            <!-- Przyciski akcji -->
            <div class="flex-shrink-0 flex gap-1">
              <!-- Przycisk edycji -->
              <p-button
                icon="pi pi-pencil"
                [text]="true"
                severity="success"
                size="small"
                (onClick)="onEditClick($event, match)"
                [attr.aria-label]="'Edytuj mecz ' + match.player_name + ' vs ' + match.opponent_name"
              />

              <!-- Przycisk usunięcia -->
              <p-button
                icon="pi pi-trash"
                [text]="true"
                severity="success"
                size="small"
                (onClick)="onDeleteClick($event, match)"
                [attr.aria-label]="'Usuń mecz ' + match.player_name + ' vs ' + match.opponent_name"
              />
            </div>
          </div>
        </article>
      }
    </div>
  }

  <!-- Paginator (widoczny gdy są wyniki) -->
  @if (!isEmpty() && !isLoading()) {
    <div class="mt-6">
      <p-paginator
        [first]="paginatorFirst()"
        [rows]="pagination().limit"
        [totalRecords]="pagination().total"
        [rowsPerPageOptions]="rowsPerPageOptions"
        (onPageChange)="onPageChange($event)"
      />
    </div>
  }
</app-layout>

<!-- Dialog edycji meczu -->
<app-edit-match-dialog
  [visible]="isEditDialogVisible()"
  [playerName]="editingMatch()?.player_name ?? ''"
  [opponentName]="editingMatch()?.opponent_name ?? ''"
  [isLoading]="isSaving()"
  (dialogClose)="onEditDialogCancel()"
  (confirmClicked)="onEditDialogConfirm($event)"
/>
