---
import Layout from '@/layouts/Layout.astro';
import { MatchSummaryPageComponent, type MatchSummaryPageComponentProps } from '@/components/match-summary/match-summary-page/match-summary-page.component';

/**
 * Match Summary Page - Widok meczu "Zakończony"
 * Służy do przeglądu zakończonego meczu tenisa stołowego.
 * Prezentuje pełne podsumowanie meczu, w tym wyniki setów, uwagi trenera oraz raport AI.
 *
 * Route: /matches/:id/summary
 * Access: Chroniony - wymaga autentykacji (middleware sprawdza automatycznie)
 * Validation: Weryfikacja ownership meczu + redirect do live jeśli in_progress
 */

const { id } = Astro.params;

// Walidacja parametru ID
if (!id || isNaN(Number(id))) {
  return Astro.redirect('/matches');
}

const matchId = Number(id);

// Middleware już sprawdza autentykację automatycznie
// Tutaj tylko pobieramy dane użytkownika dla UI

const supabase = Astro.locals.supabase;
const { data: { user } } = await supabase.auth.getUser();

// Pobranie danych użytkownika dla layoutu
const userName = user?.user_metadata?.full_name || user?.email || 'Trener';
const userEmail = user?.email || '';
const userInitials = userName
  .split(' ')
  .map(n => n[0])
  .join('')
  .toUpperCase()
  .slice(0, 2);

export const prerender = false;

// Props dla komponentu Angular
const props: MatchSummaryPageComponentProps = {
  matchId,
  userName,
  userEmail,
  userInitials,
};
---

<Layout title="Podsumowanie meczu - Spin Flow">
  <MatchSummaryPageComponent client:only="angular" {...props} />
</Layout>

